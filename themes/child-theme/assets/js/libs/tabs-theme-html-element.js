import{ThemeHTMLElement as t}from"./theme-html-element.js";import{TabsButtonThemeHtmlElement as e}from"./tabs-button-theme-html-element.js";import{TabsContentThemeHtmlElement as s}from"./tabs-content-theme-html-element.js";import{TabsWrapperThemeHtmlElement as n}from"./tabs-wrapper-theme-html-element.js";import{TabsNavigationThemeHtmlElement as o}from"./tabs-navigation-theme-html-element.js";export class TabsThemeHTMLElement extends t{static tabIndex=0;static slug="theme-tabs";childrenNames=[e.slug,s.slug,o.slug,n.slug];firstButton=null;lastButton=null;buttons=[];contents=[];constructor(){super(),++this.constructor.tabIndex}runBeforeChildrenComplete(){const t=this.getBlockName(),i=this.childrenElements[e.slug],r=this.childrenElements[s.slug],l=this.childrenElements[o.slug],a=this.childrenElements[n.slug];if(i.forEach(((e,s)=>{const n=r[s],o=`tabs-${this.constructor.tabIndex}-button-${++s}`,i=`tabs-${this.constructor.tabIndex}-content-${s}`;e.setAttribute("aria-controls",i),e.setAttribute("id",o),e.blockName=t,n.setAttribute("id",i),n.setAttribute("aria-labelledby",o),n.blockName=t,n.tabContentIndex=s-1})),l.length)l[0].append(...i),l[0].blockName=t;else{const e=this.getNewElement({name:o.slug,append:i});e.blockName=t,this.prepend(e)}if(a.length)a[0].append(...r),a[0].blockName=t;else{const e=this.getNewElement({name:n.slug,append:r});e.blockName=t,this.append(e)}}runBeforeComplete(){this.buttons=this.childrenElements[e.slug],this.contents=this.childrenElements[s.slug],this.addAllTab().then((()=>{this.firstButton=this.buttons[0].currentElement,this.lastButton=this.buttons[this.buttons.length-1].currentElement,this.buttons.forEach((t=>{t.currentElement.addEventListener("keydown",this.onKeydownByTab.bind(this)),t.currentElement.addEventListener("click",this.onClickByTab.bind(this))})),this.setCurrentTab(this.firstButton)}))}runAfterComplete(){this.classList.add(...this.getBlockClassName(["ready"]).split(" "))}setCurrentTab(t){this.buttons.forEach(((e,s)=>{const n=e.currentElement;if(t===n){const t=e.getElementClassName(["active"]),o=this.contents[s].getElementClassName(["active"]);n.setAttribute("aria-selected","true"),n.removeAttribute("tabindex"),n.className=t,this.contents[s].hidden=!1,this.contents[s].className=o}else{const t=e.getElementClassName([],["active"]),o=this.contents[s].getElementClassName([],["active"]);n.setAttribute("aria-selected","false"),n.setAttribute("tabindex","-1"),n.className=t,this.contents[s].hidden=!0,this.contents[s].className=o}}))}moveFocusToPreviousTab(t){t===this.firstButton?this.lastButton.focus():this.buttons[this.buttons.map((t=>t.currentElement)).indexOf(t)-1].currentElement.focus()}moveFocusToNextTab(t){t===this.lastButton?this.firstButton.focus():this.buttons[this.buttons.map((t=>t.currentElement)).indexOf(t)+1].currentElement.focus()}async addAllTab(){return new Promise((t=>{const e=this.getAttribute("all");if(e){let s=!1,n=!1;const o=this.buttons[0].cloneNode(!0);o.blockName=this.buttons[0].blockName,o.addEventListener("complete-child",(()=>{s=!0,n&&t()}),{once:!0}),["id","aria-controls"].forEach((t=>{o.setAttribute(t,o.getAttribute(t).replace(/-1$/,"")+"-all")})),o.currentElement.innerHTML=e,this.buttons[0].currentElement.before(o),this.buttons.unshift(o);const i=this.contents[0].cloneNode(!0);i.addEventListener("complete-child",(()=>{n=!0,s&&t()}),{once:!0}),this.contents.forEach(((t,e)=>{e&&i.append(...t.cloneNode(!0).childNodes)})),["id","aria-labelledby"].forEach((t=>{i.setAttribute(t,i.getAttribute(t).replace(/-1$/,"")+"-all")})),["id","for","aria-labelledby","aria-controls"].forEach((t=>{this.setAttributeAllPostfix(i,t)})),this.contents[0].before(i),this.contents.unshift(i)}else t()}))}setAttributeAllPostfix(t,e){t.querySelectorAll(`[${e}]`).forEach((t=>{t.setAttribute(e,t.getAttribute(e)+"-all")}))}onKeydownByTab(t){const e=t.currentTarget;let s=!1;switch(t.key){case"ArrowLeft":case"ArrowUp":this.moveFocusToPreviousTab(e),s=!0;break;case"ArrowRight":case"ArrowDown":this.moveFocusToNextTab(e),s=!0;break;case"Home":this.firstButton.focus(),s=!0;break;case"End":this.lastButton.focus(),s=!0}s&&(t.stopPropagation(),t.preventDefault())}onClickByTab(t){this.setCurrentTab(t.currentTarget)}openTab(t){this.setCurrentTab(this.buttons[t].currentElement)}}